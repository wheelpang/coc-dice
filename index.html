<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CoC d100 íŒì •</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 16px; background: #0b0f14; color: #e8eef6; }
    .card { background: #111826; border: 1px solid #1f2a3a; border-radius: 16px; padding: 14px; margin-bottom: 12px; }
    h1 { font-size: 18px; margin: 0 0 10px; }
    input, button { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #243247; background: #0f1622; color: #e8eef6; }
    button { background: #1b2a44; cursor: pointer; font-weight: 700; }
    button:active { transform: translateY(1px); }
    .mini { font-size: 12px; opacity: .85; line-height: 1.45; }
    pre { white-space: pre-wrap; word-break: break-word; background: #0f1622; border: 1px solid #243247; border-radius: 12px; padding: 12px; margin: 0; }
    .chips { display:flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    .chip { width: auto; padding: 10px 12px; border-radius: 999px; border: 1px solid #243247; background:#0f1622; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ² CoC d100 íŒì •</h1>
    <div class="mini">
      ì…ë ¥ ì˜ˆ: <b>ì²´ë ¥ 65</b> / <b>íšŒí”¼ 40</b> / <b>ì •ì‹ ë ¥ 55</b> / <b>65</b><br/>
      (ì´ë¦„ì€ ê·¸ëƒ¥ ë¼ë²¨ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤)
    </div>
  </div>

  <div class="card">
    <input id="cmd" placeholder="ì˜ˆ: ì²´ë ¥ 65" />
    <button id="go" style="margin-top:10px;">êµ´ë¦¬ê¸°</button>

    <div class="chips">
      <button class="chip" data-cmd="ì²´ë ¥ 65">ì²´ë ¥ 65</button>
      <button class="chip" data-cmd="íšŒí”¼ 40">íšŒí”¼ 40</button>
      <button class="chip" data-cmd="ì •ì‹ ë ¥ 55">ì •ì‹ ë ¥ 55</button>
      <button class="chip" data-cmd="ê´€ì°°ë ¥ 70">ê´€ì°°ë ¥ 70</button>
    </div>
  </div>

  <div class="card">
    <pre id="out">ì—¬ê¸° ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</pre>
    <button id="copy" style="margin-top:10px;">ê²°ê³¼ ë³µì‚¬</button>
  </div>

<script>
  const $ = (s)=>document.querySelector(s);
  const out = $("#out");
  const cmd = $("#cmd");

  function randInt(min, max) { // inclusive
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // CoC 7e: d100 result with success tiers
  function rollCoC(label, target) {
    // d100: 1..100
    const roll = randInt(1,100);

    const t = target;
    const hard = Math.floor(t/2);
    const extreme = Math.floor(t/5);

    let tier = "ì‹¤íŒ¨";
    if (roll <= t) tier = "ì„±ê³µ";
    if (roll <= hard) tier = "ì–´ë ¤ìš´ ì„±ê³µ";
    if (roll <= extreme) tier = "ê·¹í•œ ì„±ê³µ";

    // Optional special (common)
    let special = "";
    if (roll === 1) special = "ëŒ€ì„±ê³µ(1)";
    else if (roll === 100) special = "ì¹˜ëª…ì  ì‹¤íŒ¨(100)";
    else if (roll >= 96 && t < 50) special = "ì¹˜ëª…ì  ì‹¤íŒ¨(96-100, ëª©í‘œì¹˜<50)";

    const sp = special ? `\nâ€» ${special}` : "";
    const name = label ? `${label} ` : "";

    return [
      `ğŸ² CoC d100 íŒì •`,
      `${name}ëª©í‘œì¹˜: ${t} (ì–´ë ¤ìš´â‰¤${hard}, ê·¹í•œâ‰¤${extreme})`,
      `êµ´ë¦¼: ${roll}`,
      `íŒì •: ${tier}${sp}`
    ].join("\n");
  }

  // Parse input like "ì²´ë ¥ 65" / "ì²´ë ¥:65" / "65"
  function parseInput(raw) {
    const s = raw.trim();
    if (!s) throw new Error("ì…ë ¥ì„ í•´ì£¼ì‹œì˜¤. ì˜ˆ: ì²´ë ¥ 65");

    // Try to find a number (1..99) anywhere
    const numMatch = s.match(/(\d{1,3})/);
    if (!numMatch) throw new Error("ìˆ«ì ëª©í‘œì¹˜ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì˜ˆ: ì²´ë ¥ 65");

    let target = parseInt(numMatch[1], 10);
    if (target < 1) target = 1;
    if (target > 99) target = 99; // CoC ëª©í‘œì¹˜ëŠ” ë³´í†µ 1~99ë¡œ ì œí•œ

    // Label = text part with the number removed (optional)
    const label = s.replace(numMatch[1], "").replace(/[:\-\s]+/g, " ").trim();

    return { label, target };
  }

  function run(raw) {
    const { label, target } = parseInput(raw);
    return rollCoC(label, target);
  }

  function setOutput(text){ out.textContent = text; }

  $("#go").addEventListener("click", ()=>{
    try { setOutput(run(cmd.value)); }
    catch(e){ setOutput("âš ï¸ " + e.message); }
  });

  $("#copy").addEventListener("click", async ()=>{
    try {
      await navigator.clipboard.writeText(out.textContent);
      setOutput(out.textContent + "\n\nâœ… ë³µì‚¬ë¨");
    } catch {
      const ta = document.createElement("textarea");
      ta.value = out.textContent;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      setOutput(out.textContent + "\n\nâœ… ë³µì‚¬ë¨(ëŒ€ì²´)");
    }
  });

  document.querySelectorAll("[data-cmd]").forEach(b=>{
    b.addEventListener("click", ()=>{
      cmd.value = b.getAttribute("data-cmd");
      $("#go").click();
    });
  });

  // URL param auto-run: ?cmd=ì²´ë ¥%2065
  const params = new URLSearchParams(location.search);
  const q = params.get("cmd");
  if (q) { cmd.value = q; $("#go").click(); }
</script>
</body>
</html>
