<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CoC d100 íŒì •</title>

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin: 0;
      padding: 16px;
      background: #0b0f14;
      color: #e8eef6;
    }

    .card {
      background: #111826;
      border: 1px solid #1f2a3a;
      border-radius: 16px;
      padding: 14px;
      margin-bottom: 12px;
    }

    h1 { font-size: 18px; margin: 0 0 10px; }

    input, button {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #243247;
      background: #0f1622;
      color: #e8eef6;
      box-sizing: border-box;
    }

    button {
      background: #1b2a44;
      cursor: pointer;
      font-weight: 700;
    }

    button:active { transform: translateY(1px); }

    .mini { font-size: 12px; opacity: .85; line-height: 1.45; }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .chip {
      width: auto;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid #243247;
      background: #0f1622;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê²°ê³¼ ì¹´ë“œ (Roll20 ê°ì„±, ìš”ì²­ ë ˆì´ì•„ì›ƒ) â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

    .result-card {
      background:#0f1622;
      border:1px solid #243247;
      border-radius:16px;
      padding:14px;
    }

    .rc-name {
      font-size:18px;
      font-weight:900;
      margin-bottom:4px;
    }

    .rc-scale {
      font-size:13px;
      opacity:.85;
      margin-bottom:12px;
    }

    .rc-main {
      background:#0b0f14;
      border:1px solid #1f2a3a;
      border-radius:14px;
      padding:12px;
    }

    .rc-roll {
      font-size:20px;
      font-weight:800;
      margin-bottom:6px;
      font-variant-numeric: tabular-nums;
    }

    .rc-judge {
      font-size:16px;
      font-weight:800;
    }

    .rc-special {
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #243247;
      background:#111826;
      font-size:13px;
    }

    .rc-actions {
      margin-top:10px;
      display:flex;
      justify-content:flex-end;
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€ íŒì • ë‹¨ê³„ ìƒ‰ìƒ (ìµœì¢…ì•ˆ) â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .j-fail     { color: #ef4444; } /* ì‹¤íŒ¨: ë¶‰ì€ìƒ‰ */
    .j-normal   { color: #166534; } /* ë³´í†µ ì„±ê³µ: ì§„ë…¹ìƒ‰ */
    .j-hard     { color: #22c55e; } /* ì–´ë ¤ìš´ ì„±ê³µ: ë…¹ìƒ‰ */
    .j-extreme  { color: #a3e635; } /* ê·¹í•œì  ì„±ê³µ: ì—°ë‘ìƒ‰ */
    .j-critical { color: #facc15; } /* ëŒ€ì„±ê³µ(1): ë…¸ë‘ */
  </style>
</head>

<body>
  <div class="card">
    <h1>ğŸ² CoC d100 íŒì •</h1>
    <div class="mini">
      ì…ë ¥ ì˜ˆ: <b>ì²´ë ¥ 65</b> / <b>íšŒí”¼ 40</b> / <b>ì •ì‹ ë ¥ 55</b> / <b>65</b><br/>
      (ì•ì˜ ê¸€ìëŠ” â€œíŒì •í•­ëª©ëª…â€ìœ¼ë¡œ ì¶œë ¥ë©ë‹ˆë‹¤)
    </div>
  </div>

  <div class="card">
    <input id="cmd" placeholder="ì˜ˆ: ì²´ë ¥ 65" />
    <button id="go" style="margin-top:10px;">êµ´ë¦¬ê¸°</button>

    <div class="chips">
      <button class="chip" data-cmd="ì²´ë ¥ 65">ì²´ë ¥ 65</button>
      <button class="chip" data-cmd="íšŒí”¼ 40">íšŒí”¼ 40</button>
      <button class="chip" data-cmd="ì •ì‹ ë ¥ 55">ì •ì‹ ë ¥ 55</button>
      <button class="chip" data-cmd="ê´€ì°°ë ¥ 70">ê´€ì°°ë ¥ 70</button>
    </div>
  </div>

  <div class="card">
    <!-- ê²°ê³¼ëŠ” ì¹´ë“œë¡œ í‘œì‹œ -->
    <div id="card" class="result-card">
      <div id="rc-name" class="rc-name">íŒì •í•­ëª©</div>
      <div id="rc-scale" class="rc-scale">ì„±ê³µ - / ì–´ë ¤ìš´ - / ê·¹í•œ -</div>

      <div class="rc-main">
        <div id="rc-roll" class="rc-roll">êµ´ë¦¼ : -</div>
        <div id="rc-judge" class="rc-judge">íŒì • : -</div>
      </div>

      <div id="rc-special" class="rc-special" style="display:none;"></div>

      <div class="rc-actions">
        <button id="copyText" class="chip">í…ìŠ¤íŠ¸ ë³µì‚¬</button>
      </div>
    </div>

    <!-- ì¹´í†¡ ë³µì‚¬ìš© í…ìŠ¤íŠ¸ëŠ” ìˆ¨ê¹€ìœ¼ë¡œ ìœ ì§€ -->
    <pre id="out" style="display:none;"></pre>
  </div>

<script>
  const $ = (s)=>document.querySelector(s);
  const out = $("#out");
  const cmd = $("#cmd");

  function randInt(min, max) { // inclusive
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // Parse input like "ì²´ë ¥ 65" / "ì²´ë ¥:65" / "65"
  function parseInput(raw) {
    const s = raw.trim();
    if (!s) throw new Error("ì…ë ¥ì„ í•´ì£¼ì‹œì˜¤. ì˜ˆ: ì²´ë ¥ 65");

    const numMatch = s.match(/(\d{1,3})/);
    if (!numMatch) throw new Error("ìˆ«ì ëª©í‘œì¹˜ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì˜ˆ: ì²´ë ¥ 65");

    let target = parseInt(numMatch[1], 10);
    if (target < 1) target = 1;
    if (target > 99) target = 99; // ëª©í‘œì¹˜ 1~99ë¡œ ì œí•œ

    const label = s.replace(numMatch[1], "").replace(/[:\-\s]+/g, " ").trim();
    return { label, target };
  }

  // CoC 7e d100 data
  function rollCoCData(label, target) {
    const roll = randInt(1,100);
    const t = target;
    const hard = Math.floor(t/2);
    const extreme = Math.floor(t/5);

    // 5ë‹¨ê³„ íŒì •: ì‹¤íŒ¨ / ë³´í†µ ì„±ê³µ / ì–´ë ¤ìš´ ì„±ê³µ / ê·¹í•œì  ì„±ê³µ / ëŒ€ì„±ê³µ(1)
    let tier = "ì‹¤íŒ¨";
    if (roll === 1) {
      tier = "ëŒ€ì„±ê³µ (1)";
    } else if (roll <= extreme) {
      tier = "ê·¹í•œì  ì„±ê³µ";
    } else if (roll <= hard) {
      tier = "ì–´ë ¤ìš´ ì„±ê³µ";
    } else if (roll <= t) {
      tier = "ë³´í†µ ì„±ê³µ";
    }

    // (í‘œì‹œìš©) ì¹˜ëª…ì  ì‹¤íŒ¨ ë£°ì€ í…Œì´ë¸”ë§ˆë‹¤ ë‹¬ë¼ â€œí‘œê¸°ë§Œâ€
    let special = "";
    if (roll === 100) special = "ì¹˜ëª…ì  ì‹¤íŒ¨(100)";
    else if (roll >= 96 && t < 50) special = "ì¹˜ëª…ì  ì‹¤íŒ¨(96-100, ëª©í‘œì¹˜<50)";

    return { label, target:t, hard, extreme, roll, tier, specialText: special };
  }

  // Update card UI + apply colors
  function updateCard(data) {
    $("#rc-name").textContent = data.label || "íŒì •";
    $("#rc-scale").textContent =
      `ì„±ê³µ ${data.target} / ì–´ë ¤ìš´ ${data.hard} / ê·¹í•œ ${data.extreme}`;

    $("#rc-roll").textContent =
      `êµ´ë¦¼ : ${String(data.roll).padStart(2, "0")}`;

    const judge = $("#rc-judge");
    judge.textContent = `íŒì • : ${data.tier}`;

    // Reset + apply tier color
    judge.className = "rc-judge";
    if (data.tier.includes("ëŒ€ì„±ê³µ")) {
      judge.classList.add("j-critical");
    } else if (data.tier === "ê·¹í•œì  ì„±ê³µ") {
      judge.classList.add("j-extreme");
    } else if (data.tier === "ì–´ë ¤ìš´ ì„±ê³µ") {
      judge.classList.add("j-hard");
    } else if (data.tier === "ë³´í†µ ì„±ê³µ") {
      judge.classList.add("j-normal");
    } else {
      judge.classList.add("j-fail");
    }

    const sp = $("#rc-special");
    if (data.specialText) {
      sp.style.display = "block";
      sp.textContent = `â€» ${data.specialText}`;
    } else {
      sp.style.display = "none";
      sp.textContent = "";
    }
  }

  // Run roll: update card + create copy text
  function run(raw) {
    const { label, target } = parseInput(raw);
    const data = rollCoCData(label, target);

    updateCard(data);

    const sp = data.specialText ? `\nâ€» ${data.specialText}` : "";
    return [
      `${data.label || "íŒì •"}`,
      `ì„±ê³µ ${data.target} / ì–´ë ¤ìš´ ${data.hard} / ê·¹í•œ ${data.extreme}`,
      ``,
      `êµ´ë¦¼ : ${String(data.roll).padStart(2, "0")}`,
      `íŒì • : ${data.tier}${sp}`
    ].join("\n");
  }

  // Events
  $("#go").addEventListener("click", ()=>{
    try { out.textContent = run(cmd.value); }
    catch(e){
      out.textContent = "âš ï¸ " + e.message;
      // ì¹´ë“œë„ ì—ëŸ¬ í‘œì‹œë¡œ ê¹”ë”íˆ
      $("#rc-name").textContent = "ì˜¤ë¥˜";
      $("#rc-scale").textContent = "ì…ë ¥ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”";
      $("#rc-roll").textContent = "êµ´ë¦¼ : -";
      const j = $("#rc-judge");
      j.textContent = "íŒì • : ì‹¤íŒ¨";
      j.className = "rc-judge j-fail";
      const sp = $("#rc-special");
      sp.style.display = "block";
      sp.textContent = "â€» " + e.message;
    }
  });

  $("#copyText").addEventListener("click", async ()=>{
    try {
      await navigator.clipboard.writeText(out.textContent || "");
    } catch {
      alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
    }
  });

  document.querySelectorAll("[data-cmd]").forEach(b=>{
    b.addEventListener("click", ()=>{
      cmd.value = b.getAttribute("data-cmd");
      $("#go").click();
    });
  });

  // URL param auto-run: ?cmd=ì²´ë ¥%2065
  const params = new URLSearchParams(location.search);
  const q = params.get("cmd");
  if (q) { cmd.value = q; $("#go").click(); }
</script>
</body>
</html>
